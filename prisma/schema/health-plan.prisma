model HealthPlan {
  id              String   @id @default(uuid())
  name            PlanType
  description     String
  price           Float
  durationInDays  Int
  maxMembers      Int?
  features        Json
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  planPurchases   PlanPurchase[]
}



model Coupon {
  id             String    @id @default(uuid())
  code           String    @unique
  description    String?

  discountType   DiscountType
  discountValue  Float

  maxUsage       Int?
  usedCount      Int       @default(0)
  minOrderAmount Float?

  expiresAt      DateTime?
  isActive       Boolean   @default(true)

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  planPurchases  PlanPurchase[]
}


model PlanPurchase {
  id              String         @id @default(uuid())
  patientId       String
  planId          String
  couponId        String?
  payment         PaymentStatus?
  originalPrice   Float
  discountAmount  Float          @default(0)
  finalPrice      Float

  status          PlanStatus     @default(ACTIVE)
  startDate       DateTime       @default(now())
  endDate         DateTime
  paymentMethod   PaymentMethod?
  transactionId   String?        @unique

  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  patient         Patient        @relation(fields: [patientId], references: [id])
  plan            HealthPlan     @relation(fields: [planId], references: [id])
  coupon          Coupon?        @relation(fields: [couponId], references: [id])

  @@index([patientId])
  @@index([planId])
  @@index([couponId])
}